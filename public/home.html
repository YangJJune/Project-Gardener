<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello</title>
  </head>
  <body></body>
  <script>
    //We can get the token from the "access_token" query
    //param, available in the browsers "location" global
    const query = window.location.search.substring(1);
    console.log('query: ' + query);
    const token = query.split('access_token=')[1];
    console.log('token: ' + token);

    //Call the user info API using the fetch browser library
    fetch('https://api.github.com/user', {
      headers: {
        //Include the token in the Authorization header
        Authorization: 'token ' + token,
      },
    })
      //Parse the response as JSON
      .then((res) => res.json())
      .then((res) => {
        //Once we get the respone(which has many fields)
        //Documented here: https://developer.github.com/v3/users/#get-the-authenticated-user
        //Write "Welcome <user name>" to the documents body
        console.log(res);
        const nameNode = document.createTextNode(`Welcome, ${res.name}`);
        document.body.appendChild(nameNode);
      });
  </script>
</html>
